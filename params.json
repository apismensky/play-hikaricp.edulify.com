{"name":"play-hikaricp","tagline":"HikariCP Plugin for Play 2.2.x and 2.3.x","body":"# HikariCP Plugin for 2.3.x\r\n\r\nThis plugin works with `2.3.x` of PlayFramework and uses version `2.3.2` of HikariCP.\r\n\r\nNote, it can be made to work with Play `2.2.x` of the PlayFramework, but it requires changing the dependencies as the current build relies on the Play `2.3.x` plugin. Please, see the versions table below to see which version of Play is supported.\r\n\r\n[![Build Status](https://travis-ci.org/edulify/play-hikaricp.edulify.com.svg?branch=master)](https://travis-ci.org/edulify/play-hikaricp.edulify.com) [![Issue Stats](http://issuestats.com/github/edulify/play-hikaricp.edulify.com/badge/pr)](http://issuestats.com/github/edulify/play-hikaricp.edulify.com) [![Dependency Status](https://www.versioneye.com/user/projects/54eaa687d1ec577c97000cd5/badge.svg?style=flat)](https://www.versioneye.com/user/projects/54eaa687d1ec577c97000cd5) [![Coverage Status](https://coveralls.io/repos/edulify/play-hikaricp.edulify.com/badge.svg?branch=master)](https://coveralls.io/r/edulify/play-hikaricp.edulify.com?branch=master)\r\n\r\n## About this documentation\r\n\r\nWhen reading this documentation at Github, select the tag that matches the version of the plugin that you are using.\r\n\r\n## Why HikariCP?\r\n\r\n[HikariCP](https://github.com/brettwooldridge/HikariCP) is supposed to be the fastest connection pool in Java land. But we did not start to use it because of speed, but because of its reliability. After suffering with connection leaks from BoneCP, we decide to implement our own database plugin to replace the default one. You can see [a discussion about database exceptions](https://groups.google.com/forum/#!topic/play-framework/7PBnjiXkNuU) caused by BoneCP (or misconfiguration of it). Also there are numerous other discussions about people having problems related to BoneCP.\r\n\r\nHere is how HikariCP is working for us:\r\n\r\n![HikariCP in Production](http://i.imgur.com/xPqkc7T.png)\r\n\r\n## Versions\r\n\r\n| Version | HikariCP | Play  |\r\n|--------:|---------:|------:|\r\n| 2.0.0   | 2.3.2    | 2.3.8 |\r\n| 1.5.2   | 2.3.2    | 2.3.8 |\r\n| 1.5.1   | 2.2.5    | 2.3.7 |\r\n| 1.5.0   | 2.0.1    | 2.3.4 |\r\n| 1.4.1   | 2.0.1    | 2.3.2 |\r\n| 1.4.0   | 1.4.0    | 2.3.1 |\r\n| 1.3.1   | 1.3.8    | 2.3.1 |\r\n| 1.3.0   | 1.3.8    | 2.3.1 |\r\n| 1.2.0   | 1.3.8    | 2.2.3 |\r\n| 1.1.0   | 1.3.8    | 2.2.3 |\r\n| 1.0.0   | 1.3.5    | 2.2.2 |\r\n\r\nFor more information about what changed in each version, please, see the our CHANGELOG.md file.\r\n\r\n## Repository\r\n\r\nYou need to add the following repository in order to use this module:\r\n\r\n```scala\r\nresolvers += Resolver.url(\"Edulify Repository\", url(\"http://edulify.github.io/modules/releases/\"))(Resolver.ivyStylePatterns)\r\n```\r\n\r\n## How to Use\r\n\r\nThere are just a few steps to properly configure the plugin:\r\n\r\n### Step 1: Add the dependency\r\n\r\nAdd the following dependency to your `project/build.sbt` or `project/Build.scala`:\r\n\r\n    \"com.edulify\" %% \"play-hikaricp\" % \"2.0.0\"\r\n\r\n### Step 2: Disable default `dbplugin`\r\n\r\nAdd the following line to your `conf/application.conf`:\r\n\r\n    dbplugin=disabled\r\n\r\nThis will disable dbplugin and avoids that BoneCP creates useless connections (which in some cases can create database problems, like exhaust available connections).\r\n\r\n### Step 3: Enable HikariCP Plugin\r\n\r\nAdd the following line to your `conf/play.plugins`:\r\n\r\n    200:com.edulify.play.hikaricp.HikariCPPlugin\r\n\r\nDue to the fact that the [Play JPA plugin](https://github.com/playframework/playframework/blob/master/framework/src/play-java-jpa/src/main/resources/play.plugins) is assigned a priority of **400**, please make sure that you assign `com.edulify.play.hikaricp.HikariCPPlugin` a priority less than that when using datasources looked up via JNDI. Otherwise, during application startup when JPA attempts to create the `EntityManagerFactory` your data source will not have been bound to JNDI yet. [Play documentation](http://playframework.com/documentation/2.3.x/ScalaPlugins) states that connection pools should use a **200** priority.\r\n\r\n### Step 4: Configure HikariCP\r\n\r\nPlease, before reading this section, we recommend that you get familiarized with [HikariCP configurations](https://github.com/brettwooldridge/HikariCP#configuration-knobs-baby). It is the main source to understand each possible configuration for HikariCP and it have invaluable information about how to best configure your pool. Also, it is a good idea to read about [Typesafe Config](https://github.com/typesafehub/config), which is the configuration language used by PlayFramework.\r\n\r\nThis plugin just read each possible Hikari configuration and create the pool from it and all the defaults are honored. Here is a simple example of how to configure you pool in `application.conf`:\r\n\r\n    db {\r\n      default {\r\n        driverClassName=org.postgresql.Driver\r\n        jdbcUrl=\"jdbc:mysql://localhost:3306/simpsons\"\r\n        username=bart\r\n        password=51mp50n\r\n      }\r\n    }\r\n\r\nAlternatively, you can configure it using a data source provided by your JDBC Driver:\r\n\r\n    db {\r\n      default {\r\n        dataSourceClassName=org.postgresql.ds.PGSimpleDataSource\r\n        dataSource {\r\n          user=bart\r\n          password=51mp50n\r\n          databaseName=springfield\r\n          serverName=localhost\r\n        }\r\n      }\r\n    }\r\n\r\nHikariCP documentation has a [list of JDBC DataSource classes for popular databases](https://github.com/brettwooldridge/HikariCP#popular-datasource-class-names). Both `dataSourceClassName` and `jdbcUrl` are supported, but HikariCP recommends the former. Also, you can configure more than one database:\r\n\r\n    db {\r\n\r\n      default {\r\n        dataSourceClassName=org.postgresql.ds.PGSimpleDataSource\r\n        dataSource {\r\n          user=bart\r\n          password=51mp50n\r\n          databaseName=springfield\r\n          serverName=localhost\r\n        }\r\n      }\r\n\r\n      orders {\r\n        dataSourceClassName=org.postgresql.ds.PGSimpleDataSource\r\n          dataSource {\r\n            user=homer\r\n            password=duffbeer\r\n            databaseName=orders\r\n            serverName=localhost\r\n          }\r\n        }\r\n    }\r\n\r\n## Log SQL statements\r\n\r\nHikariCP does not offer (out of the box) a way to log SQL statements and it recommends that you use the log capacities of your database vendor. From HikariCP docs:\r\n\r\n> **Log Statement Text / Slow Query Logging**\r\n>\r\n> Like Statement caching, most major database vendors support statement logging through properties of their own driver. This includes Oracle, MySQL, Derby, MSSQL, and others. Some even support slow query logging. We consider this a \"development-time\" feature. For those few databases that do not support it, jdbcdslog-exp is a good option. Great stuff during development and pre-Production.\r\n\r\nWe take the suggestion of using [jdbcdslog-exp](https://code.google.com/p/jdbcdslog-exp/) and have implemented SQL log statement support, which can be configured by database, using `logSql` property:\r\n\r\n    db {\r\n      default {\r\n\r\n        logSql=true\r\n\r\n        dataSourceClassName=org.postgresql.ds.PGSimpleDataSource\r\n        dataSource {\r\n          user=bart\r\n          password=51mp50n\r\n          databaseName=springfield\r\n          serverName=localhost\r\n\r\n        }\r\n      }\r\n    }\r\n\r\nAfter that, you can configure the jdbcdslog-exp [log level as explained in their manual](https://code.google.com/p/jdbcdslog/wiki/UserGuide#Setup_logging_engine). Basically, you need to configure your root logger to `INFO` and then decide what jdbcdslog-exp will log (connections, statements and result sets). Here is an example using `conf/application.conf` to configure the logs:\r\n\r\n    logger.root=INFO\r\n    logger.org.jdbcdslog.ConnectionLogger=ERROR # won't log connections\r\n    logger.org.jdbcdslog.StatementLogger=INFO   # log all statements\r\n    logger.org.jdbcdslog.ResultSetLogger=ERROR  # won't log result sets\r\n\r\n## JNDI Support\r\n\r\nThanks to contributions from the community, this plugin supports to bind a DataSource to a JNDI context. Here is an example of how to add configure it in `conf/application.conf`:\r\n\r\n    db {\r\n      default {\r\n\r\n        jndiName=\"DefaultDataSource\"\r\n\r\n        dataSourceClassName=org.postgresql.ds.PGSimpleDataSource\r\n        dataSource {\r\n          user=bart\r\n          password=51mp50n\r\n          databaseName=springfield\r\n          serverName=localhost\r\n        }\r\n      }\r\n    }\r\n\r\n## Deploying to Heroku\r\n\r\nWhen using Heroku, you first need to translate its `DATABASE_URL` into another variable with the format expected by PostgreSQL JDBC Driver. As stated by [Heroku docs](https://devcenter.heroku.com/articles/heroku-postgresql#spring-java):\r\n\r\n> The `DATABASE_URL` for the Heroku Postgres add-on follows this naming convention:\r\n>\r\n>     postgres://<username>:<password>@<host>/<dbname>\r\n>\r\n> However the Postgres JDBC driver uses the following convention:\r\n>\r\n>     jdbc:postgresql://<host>:<port>/<dbname>?user=<username>&password=<password>\r\n>\r\n> Notice the additional `ql` at the end of `jdbc:postgresql`? Due to this difference you will need to hardcode the scheme to jdbc:postgresql` in your Java class or your Spring XML configuration.\r\n\r\nSo, you will need to create another environment variable with the proper format and you will also need to create variables for username and password. To do this, run the following commands:\r\n\r\n      $ heroku config:set DATABASE_JDBC_URL=\"jdbc:postgresql://host:5432/dbname\"\r\n      $ heroku config:set DATABASE_USERNAME=username\r\n      $ heroku config:set DATABASE_PASSWORD=password\r\n\r\nYou can obtain the correct values for `host`, `dbname`, `username`, and `password` from the `DATABASE_URL` environment variable, which Heroku creates for you. Then you can use these variables directly inside `application.conf`, since it is supported by [Typesafe Config](https://github.com/typesafehub/config):\r\n\r\n    db {\r\n      default {\r\n        driverClassName=org.postgresql.Driver\r\n        jdbcUrl=${DATABASE_JDBC_URL}\r\n        username=${DATABASE_USERNAME}\r\n        password=${DATABASE_PASSWORD}\r\n      }\r\n    }\r\n\r\n## Contributors\r\n\r\nYou can see a full list of contributors [here](https://github.com/edulify/play-hikaricp.edulify.com/graphs/contributors). Thank you very much to all the people that helps us to maintain and evolve this plugin.\r\n\r\n## Inspirations and Alternatives\r\n\r\nThe code here is highly inspired by the following plugins:\r\n\r\n1. [swaldman/c3p0-play](https://github.com/swaldman/c3p0-play)\r\n2. [autma/play-hikaricp-plugin](https://github.com/autma/play-hikaricp-plugin)\r\n\r\nWe decide to do our own because both plugins above looks unmaintained.\r\n\r\nThere are also two other alternatives using c3p0:\r\n\r\n1. [hadashi/play2-c3p0-plugin](https://github.com/hadashi/play2-c3p0-plugin)\r\n2. [Furyu/play-c3p0-plugin](https://github.com/Furyu/play-c3p0-plugin)\r\n\r\n## References\r\n\r\n1. [HikariCP Configuration](https://github.com/brettwooldridge/HikariCP): See information about what can be configured, supported data sources and drivers\r\n2. [Play Plugins Docs](https://playframework.com/documentation/2.3.x/ScalaPlugins): Understand how plugins are created and configured\r\n3. [Typesafe Config](https://github.com/typesafehub/config): What is supported and help with the syntax\r\n4. [jdbcdslog-exp](https://code.google.com/p/jdbcdslog-exp/): How to configure the logSql enabler\r\n5. [Heroku Docs](https://www.playframework.com/documentation/2.3.x/ProductionHeroku): Docs about how to deploy Play applications to Heroku.\r\n\r\n## License\r\n\r\nCopyright 2014 Edulify.com\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\nhttp://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}